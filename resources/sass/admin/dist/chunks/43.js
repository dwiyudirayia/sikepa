(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{awEc:function(a,e,n){"use strict";n.r(e);var t=n("Q5Zs"),s=n.n(t),r=n("l+2V"),i=n("ta7f"),l=n("+TlC"),u={name:"pengajuan-step-1",props:["accessUpdate","accessRead"],components:{MaskedInput:s.a,"pengajuan-items":l.a},data:function(){return{curStep:1,currencyMask:r.createNumberMask({prefix:"Rp. "}),yearMask:[/[1-9]/,/\d/,/\d/,/\d/],itemWriteMode:!1,form:{nama_pekerjaan:null,jenis_pekerjaan:0,prk_id:0,tahun:null},selectPrk:[]}},validations:{pengajuan:{nama_pekerjaan:{required:i.required},tahun:{required:i.required}}},computed:{isWriteable:function(){return!(!(this.isAdd||0==this.pengajuan.status&&1!=this.pengajuan.rab.penolakan_permanen)||!this.accessUpdate)},isAdd:function(){return!this.$route.params.pId},pengajuan:{get:function(){return this.$store.state.pengajuan.oneData},set:function(a){this.$store.commit("pengajuan/setOneData",a)}},listPrk:function(){return this.$store.state.master.listPrk}},created:function(){var a=this;this.$store.dispatch("master/listPrk").then(function(e){a.selectPrk=[],_.forEach(e.data,function(e,n){a.selectPrk.push({text:e.judul+" ("+a.formatPrice(e.nilai)+")",value:e.id})}),a.selectPrk.length<=0&&(a.Web.showAlert({text:"PRK belum terisi, silahkan isi dahulu data PRK",title:"Alert",type:"warning"}),a.UserAuth.hasAccess("Master.prk.has_access")?a.$router.push({name:"master.prk"}):a.$router.push({name:"pengajuan"}))}),this.isAdd&&(this.pengajuan.jenis_pekerjaan=0,this.pengajuan.tahun=moment().format("YYYY"))},methods:{formatPrice:function(a){return Object(t.conformToMask)(String(a),this.currencyMask,{guide:!1}).conformedValue},saveFirst:function(a){var e=this;if(a.preventDefault(),this.$v.$touch(),this.$v.$invalid)return this.Web.showAlert({text:"Please fix form error",title:"Alert",type:"warning"}),!1;var n={nama_pekerjaan:this.pengajuan.nama_pekerjaan,jenis_pekerjaan:this.pengajuan.jenis_pekerjaan,prk_id:this.pengajuan.prk_id,tahun:this.pengajuan.tahun};this.$store.dispatch("pengajuan/createPengajuan",n).then(function(a){e.Web.showAlert({text:"Pengajuan berhasil disimpan"}),e.$router.push({name:"pengajuan.edit",params:{pId:a.id}})}).catch(function(a){e.Web.showAlert({text:"Save data failed : "+a.message,type:"warning"})})},saveAsDraft:function(a){var e=this;if(a.preventDefault(),this.$v.$touch(),this.$v.$invalid)return this.Web.showAlert({text:"Please fix form error",title:"Alert",type:"warning"}),!1;var n={id:this.pengajuan.id,nama_pekerjaan:this.pengajuan.nama_pekerjaan,tahun:this.pengajuan.tahun};this.$store.dispatch("pengajuan/updatePengajuan",n).then(function(a){e.Web.showAlert({text:"Pengajuan berhasil disimpan"})}).catch(function(a){e.Web.showAlert({text:"Save data failed : "+a.message,type:"warning"})})},saveFinal:function(a){var e=this;a.preventDefault();var n={id:this.pengajuan.id,status:1};this.$store.dispatch("pengajuan/updatePengajuan",n).then(function(a){e.Web.showAlert({text:"Pengajuan berhasil diajukan"}),e.$router.push({name:"pengajuan"})}).catch(function(a){e.Web.showAlert({text:"Save data failed : "+a.message,type:"warning"})})}}},p=n("KHd+"),o=Object(p.a)(u,function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("b-card",{attrs:{"no-body":""}},[n("b-card-header",{staticClass:"with-elements"},[n("div",{staticClass:"card-header-title mr-2"},[n("h4",[a._v("Step 1")]),a._v(" "),n("div",[n("span",[a._v("Manage data pengajuan hingga AHS usulan oleh user SPV")]),a._v(" "),a.pengajuan.approval&&a.pengajuan.approval.ahs_usulan_spv?n("p",[n("i",[a._v("\n                  Dibuat oleh \n                  "),n("b",[a._v("\n                      "+a._s(a.pengajuan.approval.ahs_usulan_spv.user_data.name)+" - \n                      "+a._s(a.pengajuan.approval.ahs_usulan_spv.user_data.jabatan.nama)+"\n                  ")]),a._v(" \n                  pada "+a._s(a.pengajuan.approval.ahs_usulan_spv.tanggal)+"\n              ")])]):a._e()])]),a._v(" "),a.isWriteable?a._e():n("div",{staticClass:"card-header-elements ml-md-auto"},[n("b-badge",{attrs:{variant:"outline-danger"}},[a._v("Read Only")])],1)]),a._v(" "),n("b-card-body",[a.isAdd||null==a.pengajuan.rab.penolakan_permanen?a._e():n("b-alert",{attrs:{show:"",variant:"dark-warning"}},[a._v("\n      Alasan Penolakan : "+a._s(a.pengajuan.rab.catatan_penolakan)+"\n    ")]),a._v(" "),n("b-form",[n("b-form-group",{staticClass:"position-relative",attrs:{label:"Nama Pekerjaan","label-align-md":"right","label-class":"pr-md-2","label-cols-md":3}},[n("b-input",{attrs:{state:a.$v.pengajuan.nama_pekerjaan.$error?"invalid":"",placeholder:"Nama Pekerjaan",disabled:!a.isWriteable},on:{change:function(e){return a.$v.pengajuan.nama_pekerjaan.$touch()}},model:{value:a.pengajuan.nama_pekerjaan,callback:function(e){a.$set(a.pengajuan,"nama_pekerjaan","string"==typeof e?e.trim():e)},expression:"pengajuan.nama_pekerjaan"}}),a._v(" "),n("invalid-tooltip",{attrs:{inputItem:a.$v.pengajuan.nama_pekerjaan,fieldName:"Nama Pekerjaan"}})],1),a._v(" "),n("b-form-group",{attrs:{label:"Jenis Pekerjaan","label-align-md":"right","label-class":"pr-md-2","label-cols-md":3}},[n("b-select",{staticClass:"w-auto",attrs:{options:[{text:"Barang",value:0},{text:"Jasa",value:1}],disabled:!a.isWriteable||!this.isAdd},model:{value:a.pengajuan.jenis_pekerjaan,callback:function(e){a.$set(a.pengajuan,"jenis_pekerjaan",e)},expression:"pengajuan.jenis_pekerjaan"}})],1),a._v(" "),n("b-form-group",{attrs:{label:"PRK","label-align-md":"right","label-class":"pr-md-2","label-cols-md":3}},[n("b-select",{staticClass:"w-auto",attrs:{options:a.selectPrk,disabled:!a.isWriteable||!this.isAdd},model:{value:a.pengajuan.prk_id,callback:function(e){a.$set(a.pengajuan,"prk_id",e)},expression:"pengajuan.prk_id"}})],1),a._v(" "),n("b-form-row",[n("b-form-group",{staticClass:"col position-relative",attrs:{label:"Tahun","label-align-md":"right","label-class":"pr-md-2","label-cols-md":3}},[n("masked-input",{staticClass:"form-control",attrs:{type:"text",mask:a.yearMask,placeholder:"Tahun",disabled:!a.isWriteable},model:{value:a.pengajuan.tahun,callback:function(e){a.$set(a.pengajuan,"tahun","string"==typeof e?e.trim():e)},expression:"pengajuan.tahun"}})],1)],1),a._v(" "),a.isWriteable?n("div",{staticClass:"float-right"},[a.isAdd?n("b-btn",{staticClass:"btn btn-primary btn-sm",on:{click:a.saveFirst}},[a._v("Simpan")]):a._e(),a._v(" "),a.isAdd?a._e():n("b-btn",{staticClass:"btn btn-primary btn-sm",on:{click:a.saveAsDraft}},[a._v("Update")])],1):a._e()],1)],1),a._v(" "),a.isAdd?a._e():n("pengajuan-items",{attrs:{step:"1",accessRead:a.accessRead,accessUpdate:a.accessUpdate}}),a._v(" "),n("b-card-footer",[n("b-btn",{staticClass:"btn btn-success btn-sm float-right",attrs:{disabled:!(!a.isAdd&&a.isWriteable&&1==a.pengajuan.rab_final)},on:{click:a.saveFinal}},[a._v("Selesai & Ajukan")])],1)],1)},[],!1,null,null,null);e.default=o.exports}}]);